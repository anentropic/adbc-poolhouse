---
phase: 07-documentation-and-pypi-publication
plan: "05"
type: execute
wave: 2
depends_on:
  - "07-02"
  - "07-03"
  - "07-04"
files_modified: []
autonomous: false
requirements:
  - DIST-01

must_haves:
  truths:
    - "PyPI trusted publisher is registered for adbc-poolhouse on pypi.org"
    - "TestPyPI trusted publisher is registered for adbc-poolhouse on test.pypi.org"
    - "The full docs build passes with all guide pages and docstrings from Plans 02 and 03"
    - "The release workflow YAML is structurally correct with all seven jobs"
  artifacts:
    - path: ".github/workflows/release.yml"
      provides: "Release pipeline (created in Plan 04)"
      contains: "publish-testpypi"
  key_links:
    - from: "pypi.org trusted publisher"
      to: ".github/workflows/release.yml"
      via: "exact workflow filename registration"
      pattern: "release.yml"
---

<objective>
Run a final integration verification that all Wave 1 plans integrate correctly, then pause for the human to register OIDC trusted publishers on PyPI and TestPyPI (no CLI exists for this — web UI only).

Purpose: DIST-01 requires pre-registration of trusted publishers before any tag push — the OIDC exchange fails with 403 if publishers are not registered. This cannot be automated. The integration check confirms Plans 02, 03, and 04 all produce passing outputs when combined.
Output: Confirmed passing docs build + registered trusted publishers on pypi.org + test.pypi.org.
</objective>

<execution_context>
@/Users/paul/.claude/get-shit-done/workflows/execute-plan.md
@/Users/paul/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-documentation-and-pypi-publication/07-CONTEXT.md
@.planning/phases/07-documentation-and-pypi-publication/07-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Final integration verification</name>
  <files></files>
  <action>
Run four integration checks to confirm all Wave 1 plans integrated correctly:

1. Docs build:
   ```bash
   cd /Users/paul/Documents/Dev/Personal/adbc-poolhouse && uv run mkdocs build --strict
   ```
   Must exit 0 with no warnings or errors. If it fails, read the error and report which file/symbol is the cause.

2. Public API docstring check:
   ```bash
   cd /Users/paul/Documents/Dev/Personal/adbc-poolhouse && python -c "
   import adbc_poolhouse as m
   missing = [name for name in m.__all__ if isinstance(getattr(m, name), type) and not getattr(m, name).__doc__]
   if missing:
       print('MISSING docstrings:', missing)
   else:
       print('All public classes have docstrings')
   "
   ```

3. release.yml structure check:
   ```bash
   cd /Users/paul/Documents/Dev/Personal/adbc-poolhouse && python3 -c "
   import yaml
   data = yaml.safe_load(open('.github/workflows/release.yml'))
   jobs = list(data['jobs'].keys())
   expected = ['build','validate','changelog','publish-testpypi','smoke-test-testpypi','publish-pypi','deploy-docs']
   assert set(expected).issubset(set(jobs)), f'Jobs mismatch: {jobs}'
   print('release.yml jobs OK:', jobs)
   "
   ```

4. Skill and CLAUDE.md check:
   ```bash
   test -f /Users/paul/Documents/Dev/Personal/adbc-poolhouse/.claude/skills/adbc-poolhouse-docs-author/SKILL.md && echo "SKILL OK"
   grep -q "phases >= 7" /Users/paul/Documents/Dev/Personal/adbc-poolhouse/CLAUDE.md && echo "CLAUDE.md OK"
   ```

If anything fails, fix it before presenting the PyPI registration checkpoint.
  </action>
  <verify>
    <automated>cd /Users/paul/Documents/Dev/Personal/adbc-poolhouse && uv run mkdocs build --strict 2>&1 | tail -3 && echo "DOCS BUILD OK"</automated>
  </verify>
  <done>All four checks pass: docs build exits 0, all public classes have docstrings, release.yml has 7 jobs, SKILL.md and CLAUDE.md exist</done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 2: Register OIDC trusted publishers on PyPI and TestPyPI (DIST-01)</name>
  <action>
This step requires manual web UI interaction. PyPI's trusted publisher registration has no public API — it cannot be done via CLI. Claude cannot complete this step on your behalf.

Register trusted publishers on BOTH registries before pushing any release tag.

**For PyPI (pypi.org):**
1. Log in to https://pypi.org/manage/account/publishing/
2. Click "Add a new pending publisher"
3. Fill in:
   - PyPI project name: `adbc-poolhouse`
   - Owner: `anentropic`
   - Repository name: `adbc-poolhouse`
   - Workflow filename: `release.yml` (exact — must match)
   - Environment name: `pypi`
4. Submit

**For TestPyPI (test.pypi.org):**
1. Log in to https://test.pypi.org/manage/account/publishing/
2. Click "Add a new pending publisher"
3. Fill in:
   - PyPI project name: `adbc-poolhouse`
   - Owner: `anentropic`
   - Repository name: `adbc-poolhouse`
   - Workflow filename: `release.yml` (exact — must match)
   - Environment name: `testpypi`
4. Submit

**GitHub Environments:** Confirm https://github.com/anentropic/adbc-poolhouse/settings/environments has two environments: `pypi` and `testpypi`. Create them if missing (no protection rules needed — OIDC handles security).

**GitHub Pages:** Confirm Settings > Pages > Source is set to "GitHub Actions" — required for the `deploy-docs` job.
  </action>
  <verify>
    <automated>echo "Manual registration step — no automated verification possible. Confirm by attempting a tag push or checking pypi.org/manage/account/publishing/ for the registered publisher."</automated>
  </verify>
  <done>Trusted publishers registered on pypi.org (environment: pypi) and test.pypi.org (environment: testpypi); GitHub Pages source set to "GitHub Actions"; GitHub environments pypi and testpypi exist</done>
  <resume-signal>Type "registered" once both PyPI and TestPyPI trusted publishers are set up, or describe any issues encountered.</resume-signal>
</task>

</tasks>

<verification>
```bash
cd /Users/paul/Documents/Dev/Personal/adbc-poolhouse

# Final complete verification
echo "=== Docs build ===" && uv run mkdocs build --strict && echo "PASS"
echo "=== Docstrings ===" && python -c "
import adbc_poolhouse as m
missing = [n for n in m.__all__ if isinstance(getattr(m, n), type) and not getattr(m, n).__doc__]
print('PASS' if not missing else f'FAIL: {missing}')
"
echo "=== Skill ===" && test -f .claude/skills/adbc-poolhouse-docs-author/SKILL.md && echo "PASS"
echo "=== CLAUDE.md ===" && grep -q "phases >= 7" CLAUDE.md && echo "PASS"
echo "=== release.yml ===" && python3 -c "
import yaml; d=yaml.safe_load(open('.github/workflows/release.yml'))
j=list(d['jobs'].keys()); print('PASS' if 'deploy-docs' in j and 'publish-testpypi' in j else f'FAIL: {j}')
"
```
</verification>

<success_criteria>
- `uv run mkdocs build --strict` exits 0 with all guide pages and auto-generated API reference
- All public classes in `__all__` have docstrings
- `.claude/skills/adbc-poolhouse-docs-author/SKILL.md` exists
- `CLAUDE.md` exists with "phases >= 7" instruction
- release.yml has 7 jobs including deploy-docs and publish-testpypi
- Trusted publishers registered on pypi.org (environment: pypi) and test.pypi.org (environment: testpypi)
- GitHub Pages source set to "GitHub Actions" in repo settings
</success_criteria>

<output>
After completion, create `.planning/phases/07-documentation-and-pypi-publication/07-05-SUMMARY.md`
</output>
