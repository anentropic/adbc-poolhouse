---
phase: 03-config-layer
plan: 05
type: execute
wave: 2
depends_on:
  - 03-01
files_modified:
  - src/adbc_poolhouse/_mssql_config.py
  - src/adbc_poolhouse/_teradata_config.py
autonomous: true
requirements:
  - CFG-06

must_haves:
  truths:
    - "MSSQLConfig() constructs with all-optional fields"
    - "TeradataConfig(host='teradata-host') constructs successfully"
    - "MSSQLConfig covers SQL Server, Azure SQL, Azure Fabric, and Synapse via optional variant fields"
    - "TeradataConfig fields have docstring source attribution notes"
    - "MSSQL_PASSWORD env var populates MSSQLConfig.password as SecretStr"
    - "TERADATA_PASSWORD env var populates TeradataConfig.password as SecretStr"
    - "Both configs are instances of WarehouseConfig Protocol"
  artifacts:
    - path: "src/adbc_poolhouse/_mssql_config.py"
      provides: "MSSQLConfig for Columnar ADBC MSSQL driver (SQL Server, Azure SQL, Fabric, Synapse)"
      exports: ["MSSQLConfig"]
    - path: "src/adbc_poolhouse/_teradata_config.py"
      provides: "TeradataConfig for Columnar ADBC Teradata driver (LOW confidence fields)"
      exports: ["TeradataConfig"]
  key_links:
    - from: "src/adbc_poolhouse/_mssql_config.py"
      to: "src/adbc_poolhouse/_base_config.py"
      via: "class MSSQLConfig(BaseWarehouseConfig)"
      pattern: "class MSSQLConfig.*BaseWarehouseConfig"
    - from: "src/adbc_poolhouse/_teradata_config.py"
      to: "src/adbc_poolhouse/_base_config.py"
      via: "class TeradataConfig(BaseWarehouseConfig)"
      pattern: "class TeradataConfig.*BaseWarehouseConfig"
---

<objective>
Implement the final two Foundry-distributed backend configs: MSSQL (one class covering all Microsoft SQL variants) and Teradata (LOW-confidence fields from triangulated sources).

Purpose: Completes CFG-06. MSSQL is a single class per the locked decision in CONTEXT.md — covering SQL Server, Azure SQL, Fabric, and Synapse. Teradata has LOW-confidence fields due to a 404 on the Columnar driver docs page; each field must carry source attribution docstrings.
Output: _mssql_config.py, _teradata_config.py
</objective>

<execution_context>
@/Users/paul/.claude/get-shit-done/workflows/execute-plan.md
@/Users/paul/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-config-layer/03-RESEARCH.md
@.planning/phases/03-config-layer/03-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create _mssql_config.py</name>
  <files>src/adbc_poolhouse/_mssql_config.py</files>
  <action>
Create `src/adbc_poolhouse/_mssql_config.py`:

Confidence: HIGH for SQL Server/Azure SQL fields (docs.adbc-drivers.org/drivers/mssql live); MEDIUM for Fabric/Synapse-specific `fedauth` field (deepwiki source).

**LOCKED DECISION (CONTEXT.md):** One class covers SQL Server, Azure SQL, Azure Fabric, and Synapse Analytics via optional variant-specific fields — NOT separate classes per variant.

```python
from __future__ import annotations

from pydantic import SecretStr
from pydantic_settings import SettingsConfigDict

from adbc_poolhouse._base_config import BaseWarehouseConfig


class MSSQLConfig(BaseWarehouseConfig):
    """Microsoft SQL Server / Azure SQL / Azure Fabric / Synapse Analytics configuration.

    Uses the Columnar ADBC MSSQL driver (Foundry-distributed, not on PyPI).
    One class covers all Microsoft SQL variants via optional variant-specific fields:
    - SQL Server: use host + port + instance (or URI)
    - Azure SQL: use host + port, optionally fedauth for Entra ID / Azure AD auth
    - Azure Fabric / Synapse Analytics: use fedauth for managed identity or
      service principal authentication

    Pool tuning fields are inherited and loaded from MSSQL_* env vars.

    Note: This driver is distributed via the ADBC Driver Foundry, not PyPI.
    See project Phase 7 documentation for Foundry installation instructions.
    """

    model_config = SettingsConfigDict(env_prefix='MSSQL_')

    uri: str | None = None
    """Connection URI: mssql://user:pass@host[:port][/instance][?params]
    Also accepts sqlserver:// scheme. Env: MSSQL_URI."""

    host: str | None = None
    """Hostname or IP address. Alternative to URI-based connection.
    Env: MSSQL_HOST."""

    port: int | None = None
    """Port number. Default: 1433. Env: MSSQL_PORT."""

    instance: str | None = None
    """SQL Server named instance (e.g. 'SQLExpress'). Env: MSSQL_INSTANCE."""

    user: str | None = None
    """SQL auth username. Env: MSSQL_USER."""

    password: SecretStr | None = None
    """SQL auth password. Env: MSSQL_PASSWORD."""

    database: str | None = None
    """Target database name. Env: MSSQL_DATABASE."""

    trust_server_certificate: bool = False
    """Accept self-signed TLS certificates. Enable for local development.
    Env: MSSQL_TRUST_SERVER_CERTIFICATE."""

    connection_timeout: int | None = None
    """Connection timeout in seconds. Env: MSSQL_CONNECTION_TIMEOUT."""

    fedauth: str | None = None
    """Federated authentication method for Entra ID / Azure AD.
    Used for Azure SQL, Azure Fabric, and Synapse Analytics.
    Values: 'ActiveDirectoryPassword', 'ActiveDirectoryMsi',
    'ActiveDirectoryServicePrincipal', 'ActiveDirectoryInteractive'.
    Env: MSSQL_FEDAUTH."""

    def _adbc_driver_key(self) -> str:
        return 'mssql'
```

**Implementation notes:**
- `trust_server_certificate` defaults `False` — safe default; developer enables explicitly.
- `fedauth` is a plain `str` — driver accepts the string values listed in the docstring. The specific values are sourced from deepwiki.com/columnar-tech/adbc-quickstarts/4.1-microsoft-sql-server (MEDIUM confidence — verify when driver is available).
- No cross-field validators. URI and decomposed fields can coexist; driver precedence is implementation detail for Phase 4 translator.
  </action>
  <verify>
    <automated>cd /Users/paul/Documents/Dev/Personal/adbc-poolhouse && uv run python -c "
from adbc_poolhouse._mssql_config import MSSQLConfig
from adbc_poolhouse._base_config import WarehouseConfig
from pydantic import SecretStr

m = MSSQLConfig()
assert m.pool_size == 5
assert m.trust_server_certificate is False
assert m.password is None
assert m.fedauth is None
assert isinstance(m, WarehouseConfig)
print('PASS: MSSQLConfig defaults')

import os
os.environ['MSSQL_PASSWORD'] = 's3cret'
m2 = MSSQLConfig()
assert isinstance(m2.password, SecretStr)
assert 's3cret' not in repr(m2)
del os.environ['MSSQL_PASSWORD']
print('PASS: MSSQLConfig password is SecretStr')
"</automated>
  </verify>
  <done>MSSQLConfig exists covering all SQL Server and Azure variants; all fields optional; password is SecretStr; isinstance WarehouseConfig Protocol.</done>
</task>

<task type="auto">
  <name>Task 2: Create _teradata_config.py with source attribution docstrings</name>
  <files>src/adbc_poolhouse/_teradata_config.py</files>
  <action>
Create `src/adbc_poolhouse/_teradata_config.py`:

**CRITICAL:** Fields are LOW confidence — triangulated from Teradata JDBC/teradatasql Python driver docs because docs.adbc-drivers.org/drivers/teradata returned 404 at research time. Every field MUST have a docstring note attributing the source. Include a module-level warning comment and a `# TODO` comment per the locked decisions in RESEARCH.md.

```python
from __future__ import annotations

# TODO(teradata): Verify all field names against the installed Columnar ADBC
# Teradata driver when available. Fields below are triangulated from the
# Teradata JDBC driver and teradatasql Python driver parameter names.
# The Columnar ADBC driver docs page (docs.adbc-drivers.org/drivers/teradata)
# returned 404 at research time (2026-02-24).

from pydantic import SecretStr
from pydantic_settings import SettingsConfigDict

from adbc_poolhouse._base_config import BaseWarehouseConfig


class TeradataConfig(BaseWarehouseConfig):
    """Teradata warehouse configuration.

    Uses the Columnar ADBC Teradata driver (Foundry-distributed, not on PyPI).

    .. warning::
        Field names are triangulated from the Teradata JDBC driver and
        teradatasql Python driver documentation. The Columnar ADBC Teradata
        driver documentation was unavailable at research time. Verify field
        names against the installed driver before use in production.

    Pool tuning fields are inherited and loaded from TERADATA_* env vars.

    Note: This driver is distributed via the ADBC Driver Foundry, not PyPI.
    See project Phase 7 documentation for Foundry installation instructions.
    """

    model_config = SettingsConfigDict(env_prefix='TERADATA_')

    host: str | None = None
    """Teradata server hostname.
    Source: Teradata JDBC / teradatasql driver docs. Verify against Columnar ADBC driver.
    Env: TERADATA_HOST."""

    user: str | None = None
    """Database username.
    Source: Teradata JDBC / teradatasql driver docs. Verify against Columnar ADBC driver.
    Env: TERADATA_USER."""

    password: SecretStr | None = None
    """Database password.
    Source: Teradata JDBC / teradatasql driver docs. Verify against Columnar ADBC driver.
    Env: TERADATA_PASSWORD."""

    database: str | None = None
    """Default database (Teradata term for schema/namespace).
    Source: Teradata JDBC / teradatasql driver docs. Verify against Columnar ADBC driver.
    Env: TERADATA_DATABASE."""

    port: int | None = None
    """Connection port. Teradata default: 1025.
    Source: Teradata JDBC / teradatasql driver docs. Verify against Columnar ADBC driver.
    Env: TERADATA_PORT."""

    logmech: str | None = None
    """Logon mechanism: 'TD2' (default), 'LDAP', 'KRB5', 'TDNEGO'.
    Source: Teradata JDBC / teradatasql driver docs. Verify against Columnar ADBC driver.
    Env: TERADATA_LOGMECH."""

    tmode: str | None = None
    """Transaction mode: 'ANSI' or 'TERA'.
    Source: Teradata JDBC / teradatasql driver docs. Verify against Columnar ADBC driver.
    Env: TERADATA_TMODE."""

    sslmode: str | None = None
    """SSL mode: 'DISABLE', 'ALLOW', 'PREFER', 'REQUIRE', 'VERIFY-CA', 'VERIFY-FULL'.
    Source: Teradata JDBC / teradatasql driver docs. Verify against Columnar ADBC driver.
    Env: TERADATA_SSLMODE."""

    uri: str | None = None
    """Full URI if the Columnar driver supports URI-based connection.
    Source: Inferred from Foundry driver URI patterns; unconfirmed for Teradata.
    Verify against Columnar ADBC driver.
    Env: TERADATA_URI."""

    def _adbc_driver_key(self) -> str:
        return 'teradata'
```

**Implementation notes:**
- `host` is `str | None = None` (not required) — allows env-var-only construction via `TERADATA_HOST`.
- Every field carries the "Source: ... Verify against Columnar ADBC driver." note per RESEARCH.md Common Pitfall #5 guidance.
- No cross-field validators.
  </action>
  <verify>
    <automated>cd /Users/paul/Documents/Dev/Personal/adbc-poolhouse && uv run python -c "
from adbc_poolhouse._teradata_config import TeradataConfig
from adbc_poolhouse._base_config import WarehouseConfig
from pydantic import SecretStr

t = TeradataConfig()
assert t.pool_size == 5
assert t.host is None
assert t.logmech is None
assert isinstance(t, WarehouseConfig)
print('PASS: TeradataConfig defaults')

import os
os.environ['TERADATA_HOST'] = 'td-host.example.com'
os.environ['TERADATA_PASSWORD'] = 'secret123'
t2 = TeradataConfig()
assert t2.host == 'td-host.example.com'
assert isinstance(t2.password, SecretStr)
assert 'secret123' not in repr(t2)
del os.environ['TERADATA_HOST']
del os.environ['TERADATA_PASSWORD']
print('PASS: TeradataConfig env var loading and SecretStr')
"</automated>
  </verify>
  <done>TeradataConfig exists with all triangulated fields; each field has source attribution docstring; password is SecretStr; isinstance WarehouseConfig Protocol; module-level TODO comment and warning present.</done>
</task>

</tasks>

<verification>
```bash
cd /Users/paul/Documents/Dev/Personal/adbc-poolhouse
uv run python -c "
from adbc_poolhouse._mssql_config import MSSQLConfig
from adbc_poolhouse._teradata_config import TeradataConfig
from adbc_poolhouse._base_config import WarehouseConfig

for cls in [MSSQLConfig, TeradataConfig]:
    obj = cls()
    assert isinstance(obj, WarehouseConfig), f'{cls.__name__} not WarehouseConfig'
    assert obj.pool_size == 5
print('PASS: MSSQLConfig and TeradataConfig valid')
"
uv run prek 2>&1 | tail -5
```
</verification>

<success_criteria>
- `_mssql_config.py` exists covering all Microsoft SQL variants in one class
- `_teradata_config.py` exists with source-attributed field docstrings and module-level TODO
- Both construct with no required args
- password fields are SecretStr in both
- Both are instances of WarehouseConfig Protocol
- prek passes
</success_criteria>

<output>
After completion, create `.planning/phases/03-config-layer/03-05-SUMMARY.md` with:
- Files created and field decisions
- Note that TeradataConfig fields are LOW confidence (triangulated)
- Any adjustments to MSSQL fedauth values if driver was available
</output>
